<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title></title>
<script data-main="/lib/wobbulator" src="/lib/require.js" type="text/javascript"></script><link rel="stylesheet" media="all" href="/css/docco.css" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/shared.css">
<link rel="stylesheet" type="text/css" href="/css/wobbulator.css">
<script type="text/javascript">
    require.config({ urlArgs: "version=0.0.2" });
  </script>
</head>
<body>
  <header><h1>The Sounds of the Radiophonic Workshop recreated using the Web Audio API</h1>
  </header><article id="info"><p>The "Wobbulator" was one example of a recycled or salvaged
 piece of equipment put to creative use at the Radiophonic Workshop.
 The Wobbulator was in fact a beat-frequency oscillator (looking at
 archive pictures quite likely
 a <a href="http://www.radiomuseum.org/r/bruelkjae_beat_frequency_oscillato.html">Brüel
 &amp; Kjær Beat Frequency Oscillator 1022</a> (or similar) used by sound
 engineers to measure the acoustic properties of studios or by
 electrical engineers to test equipment.</p>

    <p>When the frequencies are lowered to the audible range, it can
 produce a wide variety of space-y sounds.</p>

    <p>This application is a simulation of the Wobbulator using the
 Web Audio API.</p>
  </article><article id="machine"><div id="switch" class="off"></div>
    <div id="bulb" class="off"></div>
    <div class="knob" id="frequency"></div>
    <div class="knob" id="modulation-frequency"></div>
    <div class="knob" id="modulation-depth"></div>
    <div class="knob" id="volume"></div>
  </article><article id="code"><table cellpadding="0" cellspacing="0">
<thead><tr>
<th class="docs">             <h1>               wobbulator.coffee             </h1>           </th>           <th class="code">           </th>         </tr></thead>
<tbody>
<tr id="section-1">
<td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">¶</a>               </div>               <h1>The Wobbulator</h1>

<h1>Preamble</h1>

<p>We use jQuery, backbone.js and some custom UI elements (namely a
<a href="views/knob.html">knob</a> and a <a href="views/switch.html">switch</a>) in this
application. We make these libraries available to our application
using <a href="http://requirejs.org/">require.js</a></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">require</span><span class="p">([</span><span class="s">"jquery"</span><span class="p">,</span> <span class="s">"backbone"</span><span class="p">,</span> <span class="s">"knob"</span><span class="p">,</span> <span class="s">"switch"</span><span class="p">],</span> <span class="nf">($, Backbone, KnobView, SwitchView) -&gt;</span>
  <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>
<tr id="section-2">
<td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">¶</a>               </div>               <p>We need to alert the user if the Web Audio API is not available.
Testing for the existence of <code>webkitAudioContext</code> is currently
a good way to achieve that.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="k">typeof</span><span class="p">(</span><span class="nx">webkitAudioContext</span><span class="p">)</span> <span class="o">==</span> <span class="s">'undefined'</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span><span class="p">(</span><span class="nx">AudioContext</span><span class="p">)</span> <span class="o">==</span> <span class="s">'undefined'</span>
      <span class="nx">alert</span> <span class="s">'Your browser does not support the Web Audio API'</span></pre></div>             </td>           </tr>
<tr id="section-3">
<td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">¶</a>               </div>               <h1>ModulatedOscillator</h1>

<p>This class implements a modulated oscillator. It can be
represented as a simple graph. An oscilator (Osc2) is connected
to the destination of the audioContext. A second oscillator
(Osc1) is used to modulate the frequency of Osc2.</p>

<pre style="font-family:monospace">

+--------+      +--------+
|        |      |        |
|  Osc1  +------&gt;  Gain  |
|        |      |        |
+---+----+      +---+----+
                    | Frequency
                +---v----+        +--------+
                |        |        |        |
                |  Osc2  +--------&gt; Output |
                |        |        |        |
                +--------+        +--------+

</pre>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">class</span> <span class="nx">ModulatedOscillator</span>
      <span class="nv">constructor: </span><span class="nf">(context) -&gt;</span>
        <span class="vi">@oscillator = </span><span class="nx">context</span><span class="p">.</span><span class="nx">createOscillator</span><span class="p">()</span>
        <span class="vi">@modulator = </span><span class="nx">context</span><span class="p">.</span><span class="nx">createOscillator</span><span class="p">()</span>
        <span class="vi">@modulation_gain = </span><span class="nx">context</span><span class="p">.</span><span class="nx">createGainNode</span><span class="p">()</span>
        <span class="vi">@master_gain = </span><span class="nx">context</span><span class="p">.</span><span class="nx">createGainNode</span><span class="p">()</span>

        <span class="nx">@modulator</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">@modulation_gain</span><span class="p">)</span>
        <span class="nx">@modulation_gain</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">@oscillator</span><span class="p">.</span><span class="nx">frequency</span><span class="p">)</span>

        <span class="nx">@oscillator</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">@master_gain</span><span class="p">)</span>
        <span class="nx">@master_gain</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">destination</span><span class="p">)</span>

        <span class="nx">@oscillator</span><span class="p">.</span><span class="nx">noteOn</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="nx">@modulator</span><span class="p">.</span><span class="nx">noteOn</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

      <span class="nv">setFrequency: </span><span class="nf">(value) -&gt;</span>
        <span class="vi">@oscillator.frequency.value = </span><span class="nx">value</span>

      <span class="nv">setModulationDepth: </span><span class="nf">(value) -&gt;</span>
        <span class="vi">@modulation_gain.gain.value = </span><span class="nx">value</span>

      <span class="nv">setModulationFrequency: </span><span class="nf">(value) -&gt;</span>
        <span class="vi">@modulator.frequency.value = </span><span class="nx">value</span>

      <span class="nv">setMasterGain: </span><span class="nf">(value) -&gt;</span>
        <span class="vi">@master_gain.gain.value = </span><span class="nx">value</span>

      <span class="kc">on</span><span class="o">:</span> <span class="o">-&gt;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setMasterGain</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

      <span class="kc">off</span><span class="o">:</span> <span class="o">-&gt;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setMasterGain</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></pre></div>             </td>           </tr>
<tr id="section-4">
<td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">¶</a>               </div>               <h1>Main application</h1>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">audioContext = </span><span class="k">new</span> <span class="nx">webkitAudioContext</span>
    <span class="nv">oscillator = </span><span class="k">new</span> <span class="nx">ModulatedOscillator</span><span class="p">(</span><span class="nx">audioContext</span><span class="p">)</span></pre></div>             </td>           </tr>
<tr id="section-5">
<td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">¶</a>               </div>               <p>Set the initial parameters of the oscillator</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">initialFrequency = </span><span class="mi">440</span>
    <span class="nv">initialModulationDepth = </span><span class="mi">100</span>
    <span class="nv">initialModulationFrequency = </span><span class="mi">10</span>

    <span class="nx">oscillator</span><span class="p">.</span><span class="nx">setFrequency</span><span class="p">(</span><span class="nx">initialFrequency</span><span class="p">)</span>
    <span class="nx">oscillator</span><span class="p">.</span><span class="nx">setModulationDepth</span><span class="p">(</span><span class="nx">initialModulationDepth</span><span class="p">)</span>
    <span class="nx">oscillator</span><span class="p">.</span><span class="nx">setModulationFrequency</span><span class="p">(</span><span class="nx">initialModulationFrequency</span><span class="p">)</span>

    <span class="nx">oscillator</span><span class="p">.</span><span class="kc">off</span><span class="p">()</span></pre></div>             </td>           </tr>
<tr id="section-6">
<td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">¶</a>               </div>               <h1>UI code</h1>

<p>We create an on/off switch and three knobs to set each of
the parameters of the <code>ModulatedOscillator</code>. We bind these UI
elements to divs in the markup</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">on_off_switch = </span><span class="k">new</span> <span class="nx">SwitchView</span><span class="p">(</span><span class="nv">el: </span><span class="s">'#switch'</span><span class="p">)</span>

    <span class="nv">frequency_knob = </span><span class="k">new</span> <span class="nx">KnobView</span><span class="p">(</span>
      <span class="nv">el: </span><span class="s">'#frequency'</span>
      <span class="nv">degMin: </span><span class="o">-</span><span class="mi">53</span>
      <span class="nv">degMax: </span><span class="mi">227</span>
      <span class="nv">valueMin: </span><span class="mi">50</span>
      <span class="nv">valueMax: </span><span class="mi">5000</span>
      <span class="nv">initial_value: </span><span class="nx">initialFrequency</span>
    <span class="p">)</span>

    <span class="nv">modulation_frequency_knob = </span><span class="k">new</span> <span class="nx">KnobView</span><span class="p">(</span>
      <span class="nv">el: </span><span class="s">'#modulation-frequency'</span>
      <span class="nv">valueMin: </span><span class="mi">0</span>
      <span class="nv">valueMax: </span><span class="mi">50</span>
      <span class="nv">initial_value: </span><span class="nx">initialModulationFrequency</span>
    <span class="p">)</span>

    <span class="nv">modulation_depth_knob = </span><span class="k">new</span> <span class="nx">KnobView</span><span class="p">(</span>
      <span class="nv">el: </span><span class="s">'#modulation-depth'</span>
      <span class="nv">valueMin: </span><span class="mi">0</span>
      <span class="nv">valueMax: </span><span class="mi">200</span>
      <span class="nv">initial_value: </span><span class="nx">initialModulationDepth</span>
    <span class="p">)</span>

    <span class="nv">volume_knob = </span><span class="k">new</span> <span class="nx">KnobView</span><span class="p">(</span>
      <span class="nv">el: </span><span class="s">'#volume'</span>
    <span class="p">)</span></pre></div>             </td>           </tr>
<tr id="section-7">
<td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">¶</a>               </div>               <p>Register events to be fired when each of the knob values change.
One for each parameter of the <code>ModulatedOscillator</code></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">frequency_knob</span><span class="p">.</span><span class="kc">on</span><span class="p">(</span><span class="s">'valueChanged'</span><span class="p">,</span>
      <span class="nf">(v) -&gt;</span> <span class="nx">oscillator</span><span class="p">.</span><span class="nx">setFrequency</span><span class="p">(</span><span class="nx">v</span><span class="p">))</span>

    <span class="nx">modulation_frequency_knob</span><span class="p">.</span><span class="kc">on</span><span class="p">(</span><span class="s">'valueChanged'</span><span class="p">,</span>
      <span class="nf">(v) -&gt;</span> <span class="nx">oscillator</span><span class="p">.</span><span class="nx">setModulationFrequency</span><span class="p">(</span><span class="nx">v</span><span class="p">))</span>

    <span class="nx">modulation_depth_knob</span><span class="p">.</span><span class="kc">on</span><span class="p">(</span><span class="s">'valueChanged'</span><span class="p">,</span>
      <span class="nf">(v) -&gt;</span> <span class="nx">oscillator</span><span class="p">.</span><span class="nx">setModulationDepth</span><span class="p">(</span><span class="nx">v</span><span class="p">))</span>

    <span class="nx">volume_knob</span><span class="p">.</span><span class="kc">on</span><span class="p">(</span><span class="s">'valueChanged'</span><span class="p">,</span>
      <span class="nf">(v) -&gt;</span> <span class="nx">oscillator</span><span class="p">.</span><span class="nx">setMasterGain</span><span class="p">(</span><span class="nx">v</span><span class="p">))</span></pre></div>             </td>           </tr>
<tr id="section-8">
<td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">¶</a>               </div>               <p>Register on/off events to be fired when the switch is toggled.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">on_off_switch</span><span class="p">.</span><span class="kc">on</span><span class="p">(</span><span class="s">'on'</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nx">oscillator</span><span class="p">.</span><span class="kc">on</span><span class="p">()</span>
      <span class="nx">$</span><span class="p">(</span><span class="s">'#bulb'</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s">'off'</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s">'on'</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="nx">on_off_switch</span><span class="p">.</span><span class="kc">on</span><span class="p">(</span><span class="s">'off'</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nx">oscillator</span><span class="p">.</span><span class="kc">off</span><span class="p">()</span>
      <span class="nx">$</span><span class="p">(</span><span class="s">'#bulb'</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s">'on'</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>

</pre></div>             </td>           </tr>
</tbody>
</table></article>
</body>
</html>
